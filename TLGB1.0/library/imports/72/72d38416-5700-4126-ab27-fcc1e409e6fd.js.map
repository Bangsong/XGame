{"version":3,"sources":["..\\..\\..\\..\\assets\\Scripts/assets\\Scripts\\Player.js"],"names":["gameObj","require","cc","Class","extends","Component","properties","jumpAudio","url","AudioClip","default","touchAudio","jumpHeight","type","Integer","moveSpeed","moveJump","playerY","_toucheTime","_bound","playerControll","self","scheduler","director","getScheduler","schedule","Id","PlayerScaleToSmall","scaleTo","PlayerScaleToBig","PlayerTouch","repeatForever","sequence","node","on","Node","EventType","TOUCH_START","resumeTarget","runAction","audioEngine","play","unscheduleUpdateForTarget","TOUCH_END","pauseTarget","stop","stopAction","PlayerReverse","PlayerMoveByUp","moveBy","PlayerMoveByDown","TOUCH_CANCEL","game","find","getComponent","listener","event","EventListener","TOUCH_ONE_BY_ONE","onTouchBegan","touches","target","getCurrentTarget","locationInNode","convertToNodeSpace","getLocation","playerNowX","x","gameMinX","width","gameMaxX","realSpeed","jumpUp","p","jumpDown","eventManager","addListener","onCollisionEnter","other","y","score","Label","sys","localStorage","setItem","parseInt","string","loadScene","onLoad","preloadScene"],"mappings":"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","file":"Player.js","sourceRoot":"..\\..\\..\\..\\assets\\Scripts","sourcesContent":["var gameObj = require(\"GameMainControll\");\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        jumpAudio:{\r\n            url:cc.AudioClip,\r\n            default:null\r\n        },\r\n        touchAudio:{\r\n            url:cc.AudioClip,\r\n            default:null\r\n        },\r\n        jumpHeight:{\r\n            type:cc.Integer,\r\n            default:90\r\n        },\r\n        moveSpeed:{\r\n            type:cc.Integer,\r\n            default:40\r\n        },\r\n        moveJump:{\r\n            type:cc.Integer,\r\n            default:10\r\n        },\r\n        playerY:{\r\n            type:cc.Integer,\r\n            default:-240\r\n        },\r\n        _toucheTime:1,\r\n        _bound:464,\r\n    },\r\n\r\n    playerControll () {\r\n        var self = this;\r\n        var scheduler = cc.director.getScheduler();\r\n        scheduler.schedule(function(){\r\n            self._toucheTime++;\r\n        },self,0.2);\r\n        var Id;\r\n        var PlayerScaleToSmall = cc.scaleTo(0.5,0.7,0.8);\r\n        var PlayerScaleToBig = cc.scaleTo(0.3,0.8,0.9);\r\n        var PlayerTouch = cc.repeatForever(cc.sequence(PlayerScaleToSmall,PlayerScaleToBig));\r\n        //触摸开始\r\n        self.node.on(cc.Node.EventType.TOUCH_START,function(){\r\n            self._toucheTime = 1;\r\n            scheduler.resumeTarget(self);\r\n            self.node.runAction(PlayerTouch);\r\n            Id = cc.audioEngine.play(self.touchAudio,true,0.5);\r\n            scheduler.unscheduleUpdateForTarget(self);\r\n        });\r\n        //触摸结束\r\n        self.node.on(cc.Node.EventType.TOUCH_END,function(){\r\n            var jumpHeight = self.jumpHeight * self._toucheTime;\r\n            scheduler.pauseTarget(self);\r\n            cc.audioEngine.stop(Id);\r\n            self.node.stopAction(PlayerTouch);\r\n            var PlayerReverse = cc.scaleTo(0.2,1,1);\r\n            self.node.runAction(PlayerReverse);\r\n            cc.audioEngine.play(self.jumpAudio,false,0.5);\r\n            var PlayerMoveByUp = cc.moveBy(0.5,0,jumpHeight);\r\n            var PlayerMoveByDown = cc.moveBy(0.45,0,-jumpHeight);\r\n            self.node.runAction(cc.sequence(PlayerMoveByUp,PlayerMoveByDown));\r\n        });\r\n        //触摸移动结束\r\n        self.node.on(cc.Node.EventType.TOUCH_CANCEL,function(){\r\n            var jumpHeight = self.jumpHeight * self._toucheTime;\r\n            scheduler.pauseTarget(self);\r\n            cc.audioEngine.stop(Id);\r\n            self.node.stopAction(PlayerTouch);\r\n            var PlayerReverse = cc.scaleTo(0.2,1,1);\r\n            self.node.runAction(PlayerReverse);\r\n            cc.audioEngine.play(self.jumpAudio,false,0.5);\r\n            var PlayerMoveByUp = cc.moveBy(0.5,0,jumpHeight);\r\n            var PlayerMoveByDown = cc.moveBy(0.45,0,-jumpHeight);\r\n            self.node.runAction(cc.sequence(PlayerMoveByUp,PlayerMoveByDown));\r\n        });\r\n        var game = cc.find(\"Canvas\").getComponent(gameObj);\r\n        var listener = {\r\n            event:cc.EventListener.TOUCH_ONE_BY_ONE,\r\n            onTouchBegan:function(touches,event){\r\n                var target = event.getCurrentTarget();\r\n                var locationInNode = target.convertToNodeSpace(touches.getLocation());\r\n                var playerNowX = self.node.x;\r\n                var gameMinX = (-game.node.width/2 + 15);\r\n                var gameMaxX = (game.node.width/2 - 15);\r\n                //向右移动\r\n                if(locationInNode.x > 30 && playerNowX < gameMaxX){\r\n                    //判断当前跳跃是否超过界限\r\n                    var realSpeed = self._bound - (playerNowX + self.moveSpeed);\r\n                    if(realSpeed < 0)\r\n                        realSpeed = self.moveSpeed + realSpeed;\r\n                    else\r\n                        realSpeed = self.moveSpeed;\r\n                    cc.audioEngine.play(self.jumpAudio,false,0.5);\r\n                    var jumpUp = cc.moveBy(0.1,cc.p(realSpeed,self.moveJump));\r\n                    var jumpDown = cc.moveBy(0.2,cc.p(0,-self.moveJump));\r\n                    self.node.runAction(cc.sequence(jumpUp,jumpDown));\r\n                }\r\n                //向左移动\r\n                if(locationInNode.x < 0 && playerNowX > gameMinX){\r\n                    //判断当前跳跃是否超过界限\r\n                    var realSpeed = (playerNowX - self.moveSpeed) + self._bound;\r\n                    if(realSpeed < 0)\r\n                        realSpeed = self.moveSpeed + realSpeed;\r\n                    else\r\n                        realSpeed = self.moveSpeed;\r\n                    cc.audioEngine.play(self.jumpAudio,false,0.5);\r\n                    var jumpUp = cc.moveBy(0.1,cc.p(-realSpeed,self.moveJump));\r\n                    var jumpDown = cc.moveBy(0.2,cc.p(0,-self.moveJump));\r\n                    self.node.runAction(cc.sequence(jumpUp,jumpDown));\r\n                }\r\n                return true;\r\n            },\r\n        };\r\n        cc.eventManager.addListener(listener,self.node);\r\n    },\r\n\r\n    onCollisionEnter: function (other) {\r\n        // console.log(\"发生碰撞\");\r\n        // console.log(this.node.y + \"   \"+ other.node.x);\r\n        // console.log(\"this.node.y : \"+ this.node.y + \"this.playerY + 50: \" + (this.playerY + 50))\r\n        if(this.node.y < this.playerY+3){\r\n            var score = cc.find(\"Canvas/scoreNode/score\").getComponent(cc.Label);\r\n            cc.sys.localStorage.setItem(\"score\",parseInt(score.string) - 1);//此处-1，因为Npc发生碰撞时会+1\r\n            cc.director.loadScene(\"GameOver\");\r\n        }\r\n    },\r\n\r\n    onLoad () {\r\n        cc.director.preloadScene(\"GameOver\");\r\n        this.playerControll();\r\n    },\r\n});\r\n"]}